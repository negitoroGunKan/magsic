<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Circular Motion Sprite</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #1a1a1a;
            /* Dark premium background */
            color: #ffffff;
            font-family: sans-serif;
        }

        canvas {
            display: block;
        }

        /* Options Drawer Animation */
        #controls {
            position: fixed !important;
            /* Override inline */
            top: 0;
            right: 0;
            width: 300px;
            height: 100%;
            background: rgba(0, 0, 0, 0.95) !important;
            padding: 20px !important;
            box-sizing: border-box;
            /* padding included in width */
            border-left: 1px solid #333;
            transform: translateX(100%);
            /* Hidden by default */
            transition: transform 0.3s ease-out;
            z-index: 50;
            /* Above canvas/overlays */
            display: block;
            /* Default state */
        }

        #controls.open {
            transform: translateX(0);
        }

        /* Option Toggle Button */
        #btn-options-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: auto;
            /* Preserve aspect ratio */
            cursor: pointer;
            z-index: 60;
            /* Above drawer */
            transition: transform 0.2s;
            filter: drop-shadow(0 0 5px rgba(0, 0, 0, 0.5));
        }

        #btn-options-toggle:hover {
            transform: scale(1.1);
        }

        #btn-options-toggle:active {
            transform: scale(0.9);
        }

        .record-row {
            transition: background 0.1s ease;
        }

        .record-row:hover {
            background: rgba(0, 188, 212, 0.2);
            /* Cyan subtle glow */
        }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay"
        style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:200; flex-direction:column; justify-content:center; align-items:center;">
        <div
            style="width:50px; height:50px; border:5px solid #333; border-top:5px solid #e040fb; border-radius:50%; animation:spin 1s linear infinite;">
        </div>
        <p id="loading-text" style="color:white; margin-top:20px; font-size:1.5em; letter-spacing:2px;">LOADING...</p>
        <style>
            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }

                100% {
                    transform: rotate(360deg);
                }
            }
        </style>
    </div>

    <!-- Start Screen -->
    <div id="start-screen"
        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10;">
        <img src="assets/initial2.png" alt="MagsicBeat" style="max-width: 900px; width: 80%; margin-bottom: 20px;">
        <p style="color: #fff; font-size: 1.2em; margin-bottom: 30px; letter-spacing: 1px;">initial 1.2.1</p>

        <!-- Player Select Display -->
        <div id="player-display"
            style="color: #00ffff; margin-bottom: 20px; font-size: 1.2em; cursor: pointer; border: 1px solid #00ffff; padding: 5px 15px; border-radius: 20px;">
            Player: Guest ▼
        </div>

        <button id="btn-start-select"
            style="padding: 20px 40px; font-size: 2em; background: #e040fb; color: white; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 0 20px rgba(224, 64, 251, 0.5); transition: transform 0.2s;">
            SELECT SONG
        </button>
        <button id="btn-view-records"
            style="margin-top: 15px; padding: 10px 20px; font-size: 1.2em; background: rgba(0,0,0,0.5); color: #00ffff; border: 1px solid #00ffff; border-radius: 25px; cursor: pointer; transition: all 0.2s;">
            VIEW RECORDS
        </button>
        <p style="margin-top:20px; color:#aaa; font-size: 0.9em;">MagsicBeat initial 1.2.1</p>
    </div>

    <!-- Records Overlay -->
    <div id="records-overlay"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:300; flex-direction:column; justify-content:flex-start; align-items:center; padding-top:40px; overflow-y:auto;">
        <h2 style="color:#00ffff; margin-bottom:20px;">Score Analytics & Records</h2>

        <!-- Charts Row -->
        <div style="display:flex; flex-direction:column; gap:20px; width:90%; max-width:1100px; margin-bottom:30px;">
            <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:10px; border:1px solid #555;">
                <h3 style="color:#00ffff; margin-top:0; font-size:1.1em; text-align:center;">TOP PERFORMANCE (Best
                    Scores)</h3>
                <div style="height:350px;"><canvas id="chart-best"></canvas></div>
            </div>
        </div>

        <div id="records-container"
            style="width:90%; max-width:1100px; background:rgba(255,255,255,0.05); border:1px solid #555; padding:20px; border-radius:10px; margin-bottom:30px;">
            <table style="width:100%; border-collapse:collapse; color:white; text-align:left;">
                <thead>
                    <tr style="border-bottom:2px solid #00bcd4;">
                        <th style="padding:10px;">Song</th>
                        <th style="padding:10px;">Result</th>
                        <th style="padding:10px;">Rank</th>
                        <th style="padding:10px;">Score</th>
                        <th style="padding:10px;">Acc</th>
                        <th style="padding:10px;">Gauge / Modifiers</th>
                    </tr>
                </thead>
                <tbody id="records-body">
                    <!-- Records injected here -->
                </tbody>
            </table>
        </div>
        <button id="btn-close-records"
            style="margin-bottom:40px; padding:12px 30px; background:transparent; border:1px solid #00ffff; color:#00ffff; border-radius:25px; cursor:pointer; font-size:1.1em; transition:all 0.2s;">
            Close
        </button>
    </div>

    <!-- Player Selection Overlay -->
    <div id="player-select-overlay"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:200; flex-direction:column; justify-content:center; align-items:center;">
        <h2 style="color:white; margin-bottom:20px;">Select Player</h2>
        <div id="player-list"
            style="display:flex; flex-direction:column; gap:10px; max-height:300px; overflow-y:auto; width:300px; margin-bottom:20px;">
            <!-- Player buttons injected here -->
        </div>
        <div style="display:flex; gap:10px;">
            <input type="text" id="new-player-name" placeholder="New Player Name"
                style="padding:10px; border-radius:5px; border:none;">
            <button id="btn-add-player"
                style="padding:10px 20px; background:#00bcd4; color:white; border:none; border-radius:5px;">Add</button>
        </div>
        <button id="btn-close-player"
            style="margin-top:20px; padding:10px; background:transparent; border:1px solid #aaa; color:#aaa; cursor:pointer;">Close</button>
    </div>

    <canvas id="game-canvas"></canvas>

    <!-- Pause Button UI (Fallback for Esc) -->
    <button id="btn-pause-ui"
        style="display:none; position:fixed; top:20px; left:20px; z-index:100; padding:10px 15px; background:rgba(255,255,255,0.2); border:1px solid white; color:white; border-radius:5px; cursor:pointer; font-weight:bold; transition: background 0.2s;">
        PAUSE (ESC)
    </button>

    <!-- Option Toggle Button -->
    <img id="btn-options-toggle" src="assets/opsion.png" alt="Options">

    <!-- Options Drawer -->
    <div id="controls">
        <h3>Game Mode</h3>
        <button id="btn-random">Start Random Mode</button>
        <hr style="border-color: #555;">
        <label style="cursor: pointer; display: flex; align-items: center; gap: 10px;">
            <input type="checkbox" id="auto-play-checkbox" style="width: 20px; height: 20px;">
            <span style="font-weight: bold; color: #00ffff;">AUTO PLAY</span>
        </label>
        <br>
        <div style="margin-bottom: 10px;">
            <span style="font-weight: bold; color: #fff;">Layout Type:</span><br>
            <label style="cursor: pointer; margin-right: 15px;">
                <input type="radio" name="layout-type" value="type-a"> Type A (Paired)
            </label>
            <label style="cursor: pointer; margin-right: 15px;">
                <input type="radio" name="layout-type" value="type-b"> Type B (Linear)
            </label>
            <label style="cursor: pointer;">
                <input type="radio" name="layout-type" value="default" checked> Default (Chart)
            </label>
        </div>
        <br>
        <label>
            Audio: <input type="file" id="audio-input" accept="audio/*">
        </label>
        <br><br>
        <label>
            Chart (JSON): <input type="file" id="chart-input">
        </label>
        <br><br>
        <label>
            Speed: <span id="speed-display">2.5</span> (Base: 0.5)
            <input type="range" id="speed-input" min="1.0" max="5.0" step="0.1" value="2.5" style="width: 200px;">
        </label>
        <label>
            Lane Width: <span id="lane-width-display">100</span>px
            <input type="range" id="lane-width-input" min="50" max="200" step="5" value="100" style="width: 200px;">
        </label>
        <br><br>
        <div style="border: 1px solid #555; padding: 10px; border-radius: 5px; background: rgba(255,255,255,0.05);">
            <h3 style="color:#00ffff; margin:0 0 10px 0; font-size: 1em;">LANE COVER</h3>
            <label style="cursor: pointer; display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                <input type="checkbox" id="lane-cover-checkbox" style="width: 18px; height: 18px;">
                <span style="font-weight: bold; color: #fff;">Enable Cover</span>
            </label>
            <label style="font-size: 0.9em;">
                Height: <span id="lane-cover-height-display">300</span>px
                <input type="range" id="lane-cover-height-input" min="0" max="600" step="10" value="300"
                    style="width: 100%;">
            </label>
            <br>
            <label style="font-size: 0.9em;">
                Visual Speed: x<span id="lane-cover-speed-display">1.0</span>
                <input type="range" id="lane-cover-speed-input" min="0.5" max="3.0" step="0.1" value="1.0"
                    style="width: 100%;">
            </label>
        </div>
        <br>

        <h3 style="color:#e040fb; margin:0 0 5px 0;">MODIFIERS</h3>
        <div style="margin-bottom:10px;">
            <label>ASSIST:</label><br>
            <select id="assist-select"
                style="width:200px; padding:5px; background:#222; color:white; border:1px solid #555;">
                <option value="none">None</option>
                <option value="blue_to_white">Blue -> White</option>
                <option value="space_boost">Space Boost</option>
            </select>
        </div>
        <div style="margin-bottom:10px;">
            <label>RANDOM:</label><br>
            <select id="random-select"
                style="width:200px; padding:5px; background:#222; color:white; border:1px solid #555;">
                <option value="none">None</option>
                <option value="shuffle_color">Shuffle (Color)</option>
                <option value="shuffle_chaos">Shuffle (Chaos)</option>
            </select>
        </div>
        <div style="margin-bottom:20px;">
            <label>GAUGE TYPE:</label><br>
            <select id="gauge-select"
                style="width:200px; padding:5px; background:#222; color:white; border:1px solid #555;">
                <option value="norma" selected>NORMA (70% Clear)</option>
                <option value="life">LIFE NORMAL (Bad-4%/Miss-5%)</option>
                <option value="life_hard">LIFE HARD (Bad-5%/Miss-10%)</option>
            </select>
        </div>

        <label>
            Offset: <span id="offset-display">0</span> ms <span style="font-size:10px; color:#aaa">(Result (+) &rarr;
                Move (+))</span>
            <input type="range" id="offset-input" min="-500" max="500" step="1" value="0" style="width: 200px;">
        </label>
        <button id="btn-calibrate" style="margin-left: 10px;">Calibrate</button>
        <br><br>
        <button id="btn-select-song"
            style="background:#e040fb; color:white; border:none; padding:10px 20px; font-size:16px; cursor:pointer; margin-right:10px;">Select
            Song</button>
        <button id="btn-chart">Start from File</button>
        <p style="font-size: 12px; color: #aaa;">No JSON? Auto-generates BPM 110.</p>
        <hr style="border-color: #555;">
        <a href="editor.html" target="_blank" style="color: #00bcd4; text-decoration: none; font-size: 14px;">>> Open
            Chart Editor</a>
    </div>

    <!-- Results Overlay -->
    <div id="results-overlay"
        style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:rgba(0,0,0,0.9); padding:40px; border:2px solid #00bcd4; border-radius:10px; text-align:center; z-index:100;">
        <h2 style="color:white; margin-top:0;">RESULT</h2>
        <div style="text-align:left; color:white; font-family:monospace; font-size:1.2em; line-height:1.5;">
            <p style="color:#00ffff">PERFECT: <span id="res-perfect">0</span></p>
            <p style="color:#ffeb3b">GREAT: <span id="res-great">0</span></p>
            <p style="color:#00ff00">NICE: <span id="res-nice">0</span></p>
            <p style="color:#ffae00">BAD: <span id="res-bad">0</span></p>
            <p style="color:#ff0000">MISS: <span id="res-miss">0</span></p>
            <hr style="border-color:#555;">
            <p>MAX COMBO: <span id="res-combo">0</span></p>
            <hr style="border-color:#555;">
            <p style="font-size: 0.8em; color: #aaa;">AVG DISTANCE: <span id="res-avg" style="color:white">0</span> ms
            </p>
        </div>
        <button id="btn-close-results"
            style="margin-top:20px; padding:10px 20px; font-size:1.1em; cursor:pointer;">Close</button>
    </div>

    <!-- Song Select Overlay -->
    <div id="song-select-overlay"
        style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 20; flex-direction: column; padding: 20px; box-sizing: border-box;">

        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
            <h2 style="color: #fff; margin: 0; text-shadow: 0 0 10px #e040fb;">SELECT SONG</h2>
            <div style="display:flex; gap:15px; align-items:center;">
                <div id="player-display-in-select"
                    style="color: #00bcd4; font-size: 1em; cursor: pointer; border: 1px solid #00bcd4; padding: 5px 10px; border-radius: 15px;">
                    Player: Guest ▼
                </div>
                <button id="btn-close-select"
                    style="background:none; border: 1px solid #777; color:#fff; padding: 5px 15px; cursor:pointer;">CLOSE</button>
            </div>
        </div>

        <div id="song-list" style="flex: 1; overflow-y: auto;"></div>
    </div>

    <!-- Calibration Overlay -->
    <div id="calibration-overlay"
        style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:40; flex-direction:column; justify-content:center; align-items:center;">
        <h2 style="color:#fff; font-size: 2em; margin-bottom: 20px;">Audio Calibration</h2>
        <div id="calibration-visual"
            style="width: 200px; height: 200px; border-radius: 50%; background: #333; margin-bottom: 30px;">
        </div>
        <p style="color:white; font-size: 1.5em; margin-bottom: 20px;">Tap SPACE to the beat!</p>
        <p id="calibration-status" style="color: #aaa;">Initializing...</p>
        <button id="btn-cancel-calibration" style="margin-top: 20px; padding: 10px 20px;">Cancel</button>
    </div>
    <!-- Pause Overlay -->
    <div id="pause-overlay"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:150; flex-direction:column; justify-content:center; align-items:center;">
        <h2 id="pause-status" style="color:white; font-size:4em; margin-bottom:40px; text-shadow: 0 0 20px #e040fb;">
            PAUSED</h2>
        <div id="pause-buttons" style="display:flex; flex-direction:column; gap:20px;">
            <button id="btn-resume"
                style="padding:15px 40px; font-size:1.5em; cursor:pointer; background:#e040fb; color:white; border:none; border-radius:5px; width: 250px;">RESUME</button>
            <button id="btn-retry"
                style="padding:15px 40px; font-size:1.5em; cursor:pointer; background:#333; color:white; border:1px solid #555; border-radius:5px; width: 250px;">RETRY</button>
            <button id="btn-quit"
                style="padding:15px 40px; font-size:1.5em; cursor:pointer; background:#333; color:white; border:1px solid #555; border-radius:5px; width: 250px;">QUIT</button>
        </div>
    </div>

    <script src="magusic.js?v=2"></script>
</body>

</html>